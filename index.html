<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SVG 查看器</title>
  <style>
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    .title {
      text-align: center;
      margin-bottom: 20px;
      color: #333;
    }

    .title h1 {
      margin-bottom: 10px;
      font-size: 24px;
    }

    .title p {
      color: #666;
      font-size: 16px;
    }

    .content {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    .input-area {
      grid-column: 1;
    }

    .preview-area {
      grid-column: 2;
      border: 1px solid #ccc;
      height: 400px;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 10px;
      background: #f5f5f5;
      position: relative;
    }

    #svg-input {
      width: 100%;
      height: 400px;
      padding: 10px;
      border: 1px solid #ccc;
      resize: none;
    }

    #svg-preview {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    .controls {
      grid-column: 1 / -1;
      display: flex;
      gap: 10px;
      justify-content: center;
      margin-top: 20px;
    }

    button {
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      transition: opacity 0.2s;
    }

    #run-btn {
      background-color: #007bff;
      color: white;
    }

    #clear-btn {
      background-color: #6c757d;
      color: white;
    }

    #download-png-btn {
      background-color: #28a745;
      color: white;
    }

    button:hover {
      opacity: 0.9;
    }

    #svg-preview svg {
      max-width: 100%;
      max-height: 100%;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="title">
      <h1>SVG代码转换图片下载器</h1>
      <p>使用方式：将你在 AI 工具里输出的 SVG 代码复制在左侧，点击运行后，点击下载图片</p>
    </div>
    <div class="content">
      <div class="input-area">
        <textarea id="svg-input" placeholder="在此处输入 SVG 代码..."></textarea>
      </div>
      <div class="preview-area">
        <div id="svg-preview"></div>
      </div>
    </div>
    <div class="controls">
      <button id="run-btn">运行</button>
      <button id="clear-btn">清空</button>
      <button id="download-png-btn">下载高清图片</button>
    </div>
  </div>

  <script>
    window.addEventListener('load', () => {
      console.log('页面加载完成');

      // 获取DOM元素
      const svgInput = document.getElementById('svg-input');
      const svgPreview = document.getElementById('svg-preview');
      const runBtn = document.getElementById('run-btn');
      const clearBtn = document.getElementById('clear-btn');
      const downloadPngBtn = document.getElementById('download-png-btn');

      // 确保所有元素都被正确获取
      console.log('输入框:', svgInput);
      console.log('预览区:', svgPreview);
      console.log('运行按钮:', runBtn);

      // 运行按钮点击事件
      runBtn.addEventListener('click', () => {
        const svgCode = svgInput.value.trim();
        if (svgCode) {
          try {
            if (!svgCode.includes('<svg')) {
              alert('请输入有效的SVG代码！');
              return;
            }
            svgPreview.innerHTML = svgCode;
          } catch (error) {
            console.error('更新预览时出错:', error);
            alert('处理SVG代码时出错，请检查代码格式是否正确！');
          }
        } else {
          alert('请先输入SVG代码！');
        }
      });

      // 清空按钮点击事件
      clearBtn.addEventListener('click', () => {
        svgInput.value = '';
        svgPreview.innerHTML = '';
      });

      // 下载高清PNG按钮点击事件
      downloadPngBtn.addEventListener('click', async () => {
        const svg = svgPreview.querySelector('svg');
        if (!svg) {
          alert('请先预览SVG！');
          return;
        }

        try {
          // 从 viewBox 获取原始尺寸
          const viewBox = svg.getAttribute('viewBox');
          let width, height;

          if (viewBox) {
            const [, , w, h] = viewBox.split(/[\s,]+/).map(Number);
            width = w;
            height = h;
          } else {
            // 如果没有 viewBox，使用当前尺寸
            width = svg.clientWidth || svg.getBoundingClientRect().width;
            height = svg.clientHeight || svg.getBoundingClientRect().height;
          }

          // 使用4倍超清缩放
          const scale = 4;

          // 创建Canvas
          const canvas = document.createElement('canvas');
          canvas.width = width * scale;
          canvas.height = height * scale;
          const ctx = canvas.getContext('2d');

          // 设置最高质量
          ctx.imageSmoothingEnabled = true;
          ctx.imageSmoothingQuality = 'high';

          // 将SVG转换为图片数据，添加尺寸信息
          const svgData = new XMLSerializer().serializeToString(svg);
          const svgBlob = new Blob([svgData], {type: 'image/svg+xml;charset=utf-8'});
          const url = URL.createObjectURL(svgBlob);

          // 创建图片对象
          const img = new Image();

          // 等待图片加载
          await new Promise((resolve, reject) => {
            img.onload = resolve;
            img.onerror = reject;
            img.src = url;
          });

          // 清空画布
          ctx.clearRect(0, 0, canvas.width, canvas.height);

          // 使用高质量绘制
          ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

          // 使用最高质量设置导出PNG
          const pngUrl = canvas.toDataURL('image/png', 1.0);

          // 创建下载链接
          const a = document.createElement('a');
          a.href = pngUrl;
          a.download = 'image_4k.png';
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);

          // 清理资源
          URL.revokeObjectURL(url);
        } catch (error) {
          console.error('下载PNG时出错:', error);
          alert('下载图片过程出错，请重试！');
        }
      });
    });
  </script>
</body>
</html>